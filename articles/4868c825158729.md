---
title: "Golangã§å­¦ã¶cookie"
emoji: "ğŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Go"]
published: false
---

# åŸ·ç­†ã®ãã£ã‹ã‘

è¶£å‘³ã§Goã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§èªè¨¼ç”¨ã®tokenã‚’cookieã«ã‚»ãƒƒãƒˆã™ã‚‹å‡¦ç†ã‚’æ›¸ã„ã¦ã„ã¾ã—ãŸã€‚
Cookieæ§‹é€ ä½“ã‚’è¦—ãã¨è‰²ã€…ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã‚ã‚Šã€è©³ã—ãèª¿ã¹ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã—ãŸã€‚
æœ¬è¨˜äº‹ã§ã¯ã¾ãšCookieã¨ã¯ä½•ã‹ã‚’èª¿ã¹ã€æœ€çµ‚çš„ã«Goä¸Šã§ã©ã†å®Ÿè£…ã™ã‚Œã°è‰¯ã„ã®ã‹ã‚’æ¤œè¨ã—ã¾ã™ã€‚

# ãã‚‚ãã‚‚Cookieã¨ã¯ï¼Ÿ

MDNã«ã¯ã“ã†ã‚ã‚Šã¾ã™ã€‚

> HTTP Cookie (ã‚¦ã‚§ãƒ– Cookieã€ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ Cookie) ã¯ã€ã‚µãƒ¼ãƒãƒ¼ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¦ã‚§ãƒ–ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã«é€ä¿¡ã™ã‚‹å°ã•ãªãƒ‡ãƒ¼ã‚¿ã§ã‚ã‚Šã€ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã«ä¿å­˜ã•ã‚Œã€ãã®å¾Œã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨å…±ã«åŒã˜ã‚µãƒ¼ãƒãƒ¼ã¸è¿”é€ã•ã‚Œã¾ã™ã€‚

> ä¸€èˆ¬çš„ã«ã¯ã€ 2 ã¤ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒåŒã˜ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸã‚‚ã®ã§ã‚ã‚‹ã‹ã‚’çŸ¥ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ä¾‹ãˆã°ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

https://developer.mozilla.org/ja/docs/Web/HTTP/Cookies

Goã§Cookieã‚’ã‚»ãƒƒãƒˆãƒ»èª­ã¿è¾¼ã‚€ç°¡å˜ãªå®Ÿè£…ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```go
func setCookie(w http.ResponseWriter, r *http.Request) {
    cookie := &http.Cookie{
        Name:    "token",
        Value:   "example_token_value" // èªè¨¼ç”¨ã®ãƒˆãƒ¼ã‚¯ãƒ³
    }
    // ã‚µãƒ¼ãƒã‹ã‚‰ãƒ–ãƒ©ã‚¦ã‚¶ã«Cookieã‚’æ¸¡ã™å‡¦ç†
    http.SetCookie(w, cookie)
}

func readCookie(w http.ResponseWriter, r *http.Request) {
    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰Cookieã‚’å—ã‘å–ã‚‹å‡¦ç†
    token, err := r.Cookie("token")

    if token.Value == "example_token_value" {
        // èªè¨¼æˆåŠŸ
    }
}
```

Cookieã‚’ä½“é¨“ã™ã‚‹ãã‚‰ã„ãªã‚‰`Name`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨`Value`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ååˆ†ã‹ã‚‚çŸ¥ã‚Œã¾ã›ã‚“ãŒã€ã‚‚ã£ã¨è‰²ã€…ãªè¨­å®šé …ç›®ãŒã‚ã‚Šã¾ã™ã€‚

# Cookieæ§‹é€ ä½“ã‚’è¦‹ã¦ã¿ã‚‹

Goã®`Cookie`æ§‹é€ ä½“ã®å®Ÿè£…ã‚’è¦‹ã¦ã„ãã€‚

```go:net/http/cookie.go
// A Cookie represents an HTTP cookie as sent in the Set-Cookie header of an
// HTTP response or the Cookie header of an HTTP request.
//
// See https://tools.ietf.org/html/rfc6265 for details.
type Cookie struct {
	Name  string
	Value string

	Path       string    // optional
	Domain     string    // optional
	Expires    time.Time // optional
	RawExpires string    // for reading cookies only

	// MaxAge=0 means no 'Max-Age' attribute specified.
	// MaxAge<0 means delete cookie now, equivalently 'Max-Age: 0'
	// MaxAge>0 means Max-Age attribute present and given in seconds
	MaxAge   int
	Secure   bool
	HttpOnly bool
	SameSite SameSite
	Raw      string
	Unparsed []string // Raw text of unparsed attribute-value pairs
}
```

`Name`ã¨`Value`ã¯åˆ†ã‹ã‚‹ã€‚ã•ã£ãè¦‹ãŸé€šã‚Šã€‚ãã‚Œä»¥å¤–ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½ã£ã¦ã„ãã€‚

### Pathå±æ€§

MDNã‹ã‚‰ã€‚

> Path å±æ€§ã¯ã€ Cookie ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸ URL ã®ä¸­ã«å«ã‚€å¿…è¦ãŒã‚ã‚‹ URL ã®ãƒ‘ã‚¹ã‚’ç¤ºã—ã¾ã™ã€‚ %x2F ("/") ã®æ–‡å­—ã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ¼åŒºåˆ‡ã‚Šæ–‡å­—ã¨ã—ã¦è§£é‡ˆã•ã‚Œã€ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ¼ã«ã‚‚åŒæ§˜ã«ä¸€è‡´ã—ã¾ã™ã€‚

https://developer.mozilla.org/ja/docs/Web/HTTP/Cookies

å‰è¿°ã®ã¨ãŠã‚Šã€ãƒ–ãƒ©ã‚¦ã‚¶ã¯å—ã‘å–ã£ãŸCookieã‚’ã‚µãƒ¼ãƒã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«è‡ªå‹•é€ä¿¡ã™ã‚‹ã‚ã‘ã§ã™ãŒã€ãã®è‡ªå‹•é€ä¿¡ã™ã‚‹ãƒ‘ã‚¹ã®çµã‚Šè¾¼ã¿ãŒå¯èƒ½ã§ã™ã€‚

`Cookie`æ§‹é€ ä½“ã§ã¯è¨­å®šã¯optionalã«ãªã£ã¦ã„ã¾ã™ã€‚

### Domainå±æ€§

MDNã‹ã‚‰ã€‚

> Domain å±æ€§ã¯ã€Cookie ã‚’å—ä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ãƒ›ã‚¹ãƒˆã‚’æŒ‡å®šã—ã¾ã™ã€‚æŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€æ—¢å®šã§ Cookie ã‚’è¨­å®šã—ãŸã®ã¨åŒã˜ãƒ›ã‚¹ãƒˆã¨ãªã‚Šã€ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯é™¤å¤–ã•ã‚Œã¾ã™ã€‚ Domain ãŒæŒ‡å®šã•ã‚ŒãŸå ´åˆã€ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯å¸¸ã«å«ã¾ã‚Œã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ Domain ã‚’æŒ‡å®šã™ã‚‹ã¨çœç•¥æ™‚ã‚ˆã‚Šã‚‚åˆ¶é™ãŒç·©å’Œã•ã‚Œã¾ã™ã€‚ãŸã ã—ã€ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³é–“ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é–¢ã™ã‚‹æƒ…å ±ã‚’å…±æœ‰ã™ã‚‹å ´åˆã¯æœ‰ç”¨ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚

> ä¾‹ãˆã°ã€Domain=mozilla.org ã‚’è¨­å®šã™ã‚‹ã¨ã€developer.mozilla.org ã®ã‚ˆã†ãªã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚‚å«ã¾ã‚Œã¾ã™ã€‚

https://developer.mozilla.org/ja/docs/Web/HTTP/Cookies

è¨­å®šã‚’çœç•¥ã—ãŸæ–¹ãŒåˆ¶é™ãŒå³ã—ã„ã‚ã‘ãªã®ã§ã€ç‰¹æ®µäº‹æƒ…ãŒãªã‘ã‚Œã°(â‰’ã‚ˆãåˆ†ã‹ã‚‰ãªã‘ã‚Œã°)æŒ‡å®šã—ãªã„ã§è‰¯ã•ãã†ã§ã™ã€‚
`Cookie`æ§‹é€ ä½“ã«ã‚‚optionalã¨ã‚³ãƒ¡ãƒ³ãƒˆãŒã¤ã„ã¦ã„ã¾ã™ã€‚

### Expireså±æ€§

### RawExpireså±æ€§
RawExpires string    // for reading cookies only

### MaxAgeå±æ€§

RFC6235ã‚’è¦‹ã‚‹ã¨ä»¥ä¸‹ã®è¨˜è¿°ãŒã‚ã‚Šã¾ã™ã€‚

> Max-Ageå±æ€§ã¯ã€ã‚¯ãƒƒã‚­ãƒ¼ã®æœ€å¤§æœ‰åŠ¹æœŸé™ã‚’ç¤ºã—ã¾ã™ã€‚
> ã‚¯ãƒƒã‚­ãƒ¼ã®æœ‰åŠ¹æœŸé™ã¾ã§ã®ç§’æ•°ã§è¡¨ã•ã‚Œã¾ã™ã€‚ 
> ã‚‚ã—ã‚¯ãƒƒã‚­ãƒ¼ãŒMax-Ageã¨Expireså±æ€§ã®ä¸¡æ–¹ã‚’æŒã¤å ´åˆã€Max-Ageå±æ€§ãŒå„ªå…ˆã•ã‚Œã€ã‚¯ãƒƒã‚­ãƒ¼ã®æœ‰åŠ¹æœŸé™ã‚’ç®¡ç†ã—ã¾ã™ã€‚
> ã‚¯ãƒƒã‚­ãƒ¼ãŒMax-Ageã¨Expiresã®ã©ã¡ã‚‰ã‚‚æŒãŸãªã„å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯å±æ€§ãŒãªã„å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ã€Œç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒçµ‚äº†ã™ã‚‹ã€ã¾ã§ãã®ã‚¯ãƒƒã‚­ãƒ¼ã‚’ä¿æŒã—ã¾ã™ã€‚

https://www.rfc-editor.org/rfc/rfc6265#section-5.2.1:~:text=4.1.2.2.%20%20The%20Max%2DAge%20Attribute

æœ‰åŠ¹æœŸé™ã¾ã§ã®ç§’æ•°ãŒMaxAgeãªã®ã§ã€`Cookie`æ§‹é€ ä½“ã§intå‹ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‚ã‘ã§ã™ã­ã€‚
ã¾ãŸå„ªå…ˆé †ä½ã‚‚Expireså±æ€§ã‚ˆã‚Šé«˜ãã€Max-Ageã‚‚Expiresã‚‚ä¸¡æ–¹ãªã‘ã‚Œã°ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒçµ‚äº†ã™ã‚‹ã¾ã§ã«ãªã‚‹ã‚ˆã†ã§ã™ã€‚(ãƒ–ãƒ©ã‚¦ã‚¶ãªã‚‰é–‰ã˜ãŸã‚‰çµ‚ã‚ã‚Š)

Max-Ageå±æ€§ã¨Expireså±æ€§ã®ã©ã¡ã‚‰ã‚’è¨­å®šã™ã‚Œã°è‰¯ã„ã®ã‹å½“ç„¶ã®ç–‘å•ãŒç”Ÿã˜ã¾ã™ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ãªè¨˜äº‹ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚
IEãŒMax-Ageå±æ€§ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ãŠã‚‰ãšã€Expireså±æ€§ã®è¨­å®šãŒå¿…é ˆã¨ã„ã†äº‹æƒ…ãŒã‚ã£ãŸã‚ˆã†ã§ã™ã€‚

https://teratail.com/questions/43007

RFCã«ã‚‚ä»¥ä¸‹ã®ã‚ˆã†ãªæ³¨æ„æ›¸ããŒã‚ã‚Šã¾ã—ãŸã€‚

>æ³¨æ„ï¼šã„ãã¤ã‹ã®æ—¢å­˜ã®åˆ©ç”¨è€…ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ï¼ŒMax-Ageå±æ€§ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚ Max-Ageå±æ€§ã‚’ã‚µãƒãƒ¼ãƒˆã—ãªã„åˆ©ç”¨è€…ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ã€ã“ã®å±æ€§ã‚’ç„¡è¦–ã—ã¾ã™ã€‚

IEå¯¾å¿œã®å¿…è¦ãŒã‚‚ã†çµ‚ã‚ã£ãŸç¾åœ¨ã¨ãªã£ã¦ã¯ã€Max-Ageã‚’ä½¿ã£ã¦ã„ãã¹ããªã‚“ã§ã—ã‚‡ã†ã‹ã€‚
ã‚‚ã—ãã¯ä¿é™ºã®æ„å‘³ã§ä¸¡æ–¹è¨­å®šã—ã¦ãŠãã¨ã„ã†ã“ã¨ã‚‚è€ƒãˆã‚‰ã‚Œãã†ã§ã™ã€‚

### Secureå±æ€§

### HttpOnlyå±æ€§

### SameSiteå±æ€§

### Rawå±æ€§

### Unparsedå±æ€§

// Raw text of unparsed attribute-value pairs

# ãŠã¾ã‘:SetCookieãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’ã‚„ã£ã¦ã¿ã‚‹
