---
title: "Golangã§ä¸¦è¡Œå‡¦ç†ã‚’è¡Œã†ãƒ¬ã‚·ãƒ”"
emoji: "ğŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Go"]
published: false
---

# ã¯ã˜ã‚ã«

Go ã‚’å­¦ã¶ä»¥å‰ã¯ Go ã¨è¨€ãˆã°ä¸¦è¡Œå‡¦ç†ã¨ã„ã†ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã—ãŸãŒã€å®Ÿå‹™ã§æ›¸ã„ã¦ã„ã¦æ„å¤–ã¨ä¸¦è¡Œå‡¦ç†ã‚’æ›¸ãã“ã¨ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
ä¸¦è¡Œå‡¦ç†ã‚’ç”¨ã„ã‚‹ã»ã©éæ©Ÿèƒ½è¦ä»¶ãŒå³ã—ããªã‹ã£ãŸã®ã‚‚ã‚ã‚Šã¾ã™ãŒã€ãã‚‚ãã‚‚ Go è‡ªä½“å‡¦ç†ãŒæ—©ã„ã®ã¨ä¸¦è¡Œå‡¦ç†ã‚’ä½¿ã†ä»¥å‰ã«ã‚„ã‚‹ã“ã¨ãŒã‚ã‚‹ã¨ã„ã†å…·åˆã§ã—ãŸã€‚ï¼ˆä¾‹ãˆã° N + 1 ã«ãªã£ã¦ã„ã‚‹ã¨ã“ã‚ã‚’ç›´ã™ã¨ã‹ã€ Pub/Sub ç­‰ã§éåŒæœŸå‡¦ç†ã«åˆ‡ã‚Šé›¢ã™ã¹ãã¨ã‹ï¼‰
ãŸã è¦ä»¶ãŒãƒªãƒƒãƒã«ãªã£ã¦ãã¦ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å‡¦ç†ãŒã©ã†ã—ã¦ã‚‚é•·ããªã‚‹ã“ã¨ãŒã‚ã‚Šã€ä¸¦è¡Œå‡¦ç†ã®å‹ã‚’è‡ªåˆ†ã«å®šç€ã•ã›ã‚‹ãŸã‚ã«ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚

# å„ä¸¦è¡Œå‡¦ç†ã®çµæœã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ãªãã¦è‰¯ã„å ´åˆ

ä»¥ä¸‹ã®ã‚ˆã†ã« publish1 ã¨ publish2 ã¯ãŠäº’ã„ã«å½±éŸ¿ã‚’åŠã¼ã™ã‚‚ã®ã§ã¯ãªãã€ã¾ãŸå‘¼ã³å‡ºã—å…ƒã§ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹å¿…è¦ãŒãªã„é–¢æ•°ã ã¨ã—ã¾ã™ã€‚
ã“ã†ã„ã£ãŸå ´åˆã€ publish1 ã¨ publish2 ã‚’é€æ¬¡çš„ã«å‡¦ç†ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```go:main.go
package main

import (
	"fmt"
	"time"
)

func main() {
	now := time.Now()

	fmt.Println("do something")

	publish1()
	publish2()

	fmt.Println(time.Since(now))
}

func publish1() {
	time.Sleep(1 * time.Second)
	fmt.Println("Publishing1")
}

func publish2() {
	time.Sleep(1 * time.Second)
	fmt.Println("Publishing2")
}
```

å®Ÿè¡Œã™ã‚‹ã¨ 2 ç§’ç¨‹åº¦ã‹ã‹ã‚Šã¾ã™ã€‚

```
% go run main.go
do something
Publishing1
Publishing2
2.002445459s
```

ä¸¦è¡Œå‡¦ç†ã‚’å–ã‚Šå…¥ã‚Œã‚‹ã¨ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```go:main.go
package main

import (
	"fmt"
	"sync"
	"time"
)

func main() {
	now := time.Now()

	fmt.Println("do something")

    // 2 ã¤ä¸¦è¡Œå‡¦ç†ã‚’è¡Œã†ã‚ˆã†ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ã‚»ãƒƒãƒˆ
	waitCount := 2
	var wg sync.WaitGroup
	wg.Add(waitCount)

	go func() {
        // goroutine ãŒçµ‚äº†ã™ã‚‹æ™‚ã«ã‚«ã‚¦ãƒ³ãƒˆã‚’æ¸›ã‚‰ã™
		defer wg.Done()
		publish1()
	}()

	go func() {
		defer wg.Done()
		publish2()
	}()

    // ã‚«ã‚¦ãƒ³ãƒˆãŒ 0 ã«ãªã‚‹ã¾ã§ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹
    // ã“ã‚Œã‚’æ›¸ã‹ãªã„ã¨ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œãªã„ã®ã§ã€
    // goroutine ãŒçµ‚äº†ã™ã‚‹ä»¥å‰ã«ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ãŒçµ‚ã‚ã£ã¦ã—ã¾ã†
	wg.Wait()

	fmt.Println(time.Since(now))
}

func publish1() {
	time.Sleep(1 * time.Second)
	fmt.Println("Publishing1")
}

func publish2() {
	time.Sleep(1 * time.Second)
	fmt.Println("Publishing2")
}
```

å®Ÿè¡Œã™ã‚‹ã¨ 1 ç§’ç¨‹åº¦ã§ã€ä¸¦è¡Œå‡¦ç†ãŒä¸Šæ‰‹ãã„ã£ã¦ã„ã¾ã™ã­ã€‚

```
% go run main.go
do something
Publishing2
Publishing1
1.001423917s
```

# å„ä¸¦è¡Œå‡¦ç†ã®çµæœã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹å ´åˆã§ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯ã—ãªãã¦è‰¯ã„å ´åˆ

ä»¥ä¸‹ã®ã‚ˆã†ã« publish1 ã¨ publish2 ã®çµæœã‚’å—ã‘å–ã£ã¦ä½¿ã„ãŸã„å ´åˆã ã¨ã—ã¾ã™ã€‚

```go:main.go
package main

import (
	"fmt"
	"time"
)

func main() {
	now := time.Now()

	fmt.Println("do something")

	result := make([]string, 0, 2)

	result = append(result, publish1())
	result = append(result, publish2())

	fmt.Println(result)

	fmt.Println(time.Since(now))
}

func publish1() string {
	time.Sleep(1 * time.Second)
	return "Publishing1"
}

func publish2() string {
	time.Sleep(1 * time.Second)
	return "Publishing2"
}
```

å®Ÿè¡Œã™ã‚‹ã¨ 2 ç§’ç¨‹åº¦ã‹ã‹ã‚Šã¾ã™ã€‚

```
% go run main.go
do something
[Publishing1 Publishing2]
2.002377375s
```

ä¸¦è¡Œå‡¦ç†ã‚’å–ã‚Šå…¥ã‚Œã‚‹ã¨ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```go:main.go
package main

import (
	"fmt"
	"sync"
	"time"
)

func main() {
	now := time.Now()

	fmt.Println("do something")

	waitCount := 2
	var wg sync.WaitGroup
	wg.Add(waitCount)

	result := make([]string, 2, 2)

	go func() {
		defer wg.Done()
		r := publish1()
		result[0] = r
	}()

	go func() {
		defer wg.Done()
		r := publish2()
		result[1] = r
	}()

	wg.Wait()

	fmt.Println(result)

	fmt.Println(time.Since(now))
}

func publish1() string {
	time.Sleep(1 * time.Second)
	return "Publishing1"
}

func publish2() string {
	time.Sleep(1 * time.Second)
	return "Publishing2"
}
```

å®Ÿè¡Œã™ã‚‹ã¨ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```
% go run main.go
do something
[Publishing1 Publishing2]
1.001352834s
```

å…ˆã»ã©ã¨ã»ã¨ã‚“ã©åŒã˜ã§ã™ãŒã€ãƒã‚¤ãƒ³ãƒˆã¯ result ã®ã‚¹ãƒ©ã‚¤ã‚¹ã‚’ã¯ã˜ã‚ã‹ã‚‰ len ãŒ 2 ã¨ã—ã¦ç”Ÿæˆã—ã¦ã„ã‚‹ã¨ã“ã‚ã§ã™ã€‚
ã¤ã¾ã‚Š result ã¯ç”Ÿæˆæ™‚ç‚¹ã§ç©ºæ–‡å­—ãŒ 2 ã¤å…¥ã£ã¦ã„ã‚‹ã‚¹ãƒ©ã‚¤ã‚¹ã§ã™ã€‚ï¼ˆç©ºã‚¹ãƒ©ã‚¤ã‚¹ã§ãªã„ï¼‰
ã“ã‚Œã¯ä¸¦è¡Œå‡¦ç†ã§ã‚ã‚‹ä»¥ä¸Šã€ publish1 ã¨ publish2 ã®ã©ã¡ã‚‰ãŒå…ˆã«çµ‚ã‚ã‚‹ã‹ã¯ä¿è¨¼ã•ã‚Œã¦ã„ãªã„ã®ã§ã€

```go:main.go
```