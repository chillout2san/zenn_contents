---
title: "Golangã§APIã‚’ä½œã‚‹æ™‚ã«è¦‹ã‚‹ãƒ¬ã‚·ãƒ”é›†"
emoji: "ğŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Go"]
published: true
---

# ã¯ã˜ã‚ã«
Goã§APIã‚’ä½œã‚‹éš›ã«ã‚ˆãæ›¸ãå‡¦ç†ã‚’ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚
ä»Šå¾Œã‚‚ä½•ã‹ã‚ˆãä½¿ã†å®Ÿè£…ã‚’æ€ã„ä»˜ãæ¬¡ç¬¬ã€å¼•ãç¶šãåŠ ç­†ãƒ»ä¿®æ­£ã—ã¦ã„ãäºˆå®šã§ã™ã€‚
èª¬æ˜ã®éƒ½åˆä¸Šã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ„è­˜ã—ã¦ã„ãªã„å®Ÿè£…ã«ãªã£ã¦ã„ã‚‹ç®‡æ‰€ãŒã‚ã‚‹ã®ã§ã€é©å®œã‚«ã‚¹ã‚¿ãƒ ã—ã¦ä½¿ã£ã¦ãã ã•ã„ã€‚

:::message
æœ¬è¨˜äº‹ã¯Qiitaã§æ²è¼‰ã—ã¦ã„ãŸä»¥ä¸‹è¨˜äº‹ã®Zennç§»æ¤ç‰ˆã§ã™ã€‚
ä¸€éƒ¨åŠ ç­†ãƒ»ä¿®æ­£ã—ã¦ã„ã¾ã™ã€‚
:::

https://qiita.com/2san/items/7fd4fc50e01dd5b994d2

# DBã¨æ¥ç¶šã—ãŸã„å ´åˆ

```go
import (
	"database/sql"
	"time"

	"github.com/go-sql-driver/mysql"
)

// Closeå‡¦ç†ã¯mainãƒ«ãƒ¼ãƒãƒ³ã«æ›¸ãã€‚
// ã“ã®Dbã‚’importã—ã¦ä½¿ã„å›ã™
var Db *sql.DB

func init() {
	jst, err := time.LoadLocation("Asia/Tokyo")
	if err != nil {
		// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
	}

	// å®Ÿéš›ã«ã¯ç’°å¢ƒå¤‰æ•°ã‚’å‚ç…§ã™ã‚‹ãŒä¾¿å®œä¸Šãƒ™ã‚¿æ›¸ã
	c := mysql.Config{
		DBName:    "dbname",
		User:      "user",
		Passwd:    "pass",
		Addr:      "localhost:3306",
		Net:       "tcp",
		ParseTime: true,
		Collation: "utf8mb4_general_ci",
		Loc:       jst,
	}

	db, err := sql.Open("mysql", c.FormatDSN())

	if err != nil {
		// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
	}

	Db = db
}
```

### è£œè¶³â‘  dsnã®æ§‹é€ ä½“ã«ã¤ã„ã¦

ä»¥ä¸‹ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚

https://zenn.dev/mstn_/articles/75667657fa5aed

ã¡ãªã¿ã«Configæ§‹é€ ä½“ã¯ä»–ã«ã‚‚è‰²ã€…ãªè¨­å®šé …ç›®ãŒã‚ã‚Šã¾ã™ã€‚

https://pkg.go.dev/github.com/go-sql-driver/mysql@v1.6.0#Config

### è£œè¶³â‘¡ Collationã«ã¤ã„ã¦

Collationã£ã¦ãªã‚“ã ã£ã‘ã¨æ€ã£ãŸã®ã§èª¿ã¹ã¾ã—ãŸã€‚
ä»¥ä¸‹ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚Šã¾ã™ã€‚

https://qiita.com/kazu56/items/6af85ffcf8d3954455ad

### è£œè¶³â‘¢ utf8mb4ã«ã¤ã„ã¦

ä½•ã¨ãªãä½¿ã£ã¦ããŸutf8mb4ã§ã™ãŒã€å…ˆæ—¥åŸ·ç­†ã—ãŸä»¥ä¸‹è¨˜äº‹ã®ã¨ãŠã‚Šã€UTF-8ã¯1ã€œ4ãƒã‚¤ãƒˆå¯¾å¿œã®ã¯ãšã¨æ€ã£ã¦èª¿ã¹ã¾ã—ãŸã€‚
æ­´å²çš„çµŒç·¯ã«ã‚ˆã£ã¦ãã†ãªã£ã¦ã„ã‚‹ã‚ˆã†ã§ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚‚utf8ã§ã¯ãªãã€æ˜ç¤ºçš„ã«utf8mb4ã¨æŒ‡å®šã™ã‚‹ã‚ˆã†æ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

https://zenn.dev/chillout2san/articles/85dfdc03ccf2c3

å‚è€ƒè¨˜äº‹ã€‚

https://penpen-dev.com/blog/mysql-utf8-utf8mb4/#toc2

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€‚

https://dev.mysql.com/doc/refman/8.0/ja/charset-unicode-utf8.html

# CRUDå‡¦ç†ã®Readå‡¦ç†ã‚’ã—ãŸã„å ´åˆ(ä¸€ã¤ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¿”ã™)

```go
type User struct {
	Id   string
	Name string
	Age  int
}

func FetchUser(ctx context.Context, userId string) (User, error) {
	// RDBMSã«ã‚ˆã£ã¦è¡¨è¨˜ãŒé•ã†ã€‚MySQLã¯`?`ã€PostgreSQLã¯`$1`,`$2`...ã§è¡¨ç¾ã€‚
	query := `SELECT * FROM users WHERE id = ?`

	row:= Db.QueryRowContext(ctx, query, userId)

	// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å„å€¤ã‚’å—ã‘å–ã‚‹ãŸã‚ã®å™¨ã‚’ç”¨æ„ã™ã‚‹
	var (
		id, name string
	)

	var (
		age int
	)

	// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–ã£ã¦ããŸå€¤ã‚’å¤‰æ•°ã«ãƒ‘ãƒ¼ã‚¹ã™ã‚‹
	if err := row.Scan(&id, &name, &age); err != nil {
		return User{}, err
	}

	user := User{
		Id:   id,
		Name: name,
		Age:  age,
	}

	return user, nil
}
```

### è£œè¶³ ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒãªã„ã“ã¨ãŒè€ƒãˆã‚‰ã‚Œã‚‹å ´åˆ

ã‚¿ã‚¤ãƒˆãƒ«ã«ã‚‚ã‚ã‚‹é€šã‚Šã€`QueryRowContext`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒä¸€ã¤ã ã‘ã‚ã‚‹ã¨åˆ†ã‹ã£ã¦ã„ã‚‹å ´åˆã§ã™ã€‚
ãªã®ã§ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒãªã„å ´åˆã¯`sql: no rows in result set`ã¨è¨€ã†ã‚¨ãƒ©ãƒ¼ãŒè¿”ã£ã¦ãã¦ã—ã¾ã„ã¾ã™ã€‚
ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒãªã„å ´åˆã«ã‚‚å‘¼ã°ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹å ´åˆã¯ã€`QueryRowContext`ã‚’ä½¿ã‚ãšã«æ¬¡ã®è¤‡æ•°ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¿”ã™`QueryContext`ã‚’ä½¿ã„ã¾ã—ã‚‡ã†ã€‚

`QueryContext`ã®ä¾‹ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚

```go
func FetchUser(ctx context.Context, userId string) (User, error) {
	query := `SELECT * FROM users WHERE id = ?`

	// è¿”ã£ã¦ãã‚‹ã¨ã—ãŸã‚‰ä¸€ã¤ã¨åˆ†ã‹ã£ã¦ã„ã‚‹ã®ã§ã€rowsã§ã¯ãªãrowã¨è¨€ã†å‘½åã«ã—ã¦ã„ã‚‹
	row, err := Db.QueryContext(ctx, query, userId)

	if err != nil {
		return User{}, err
	}

	defer row.Close()

	var (
		id, name string
	)

	var (
		age int
	)

	// ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒ0ä»¶ã®å ´åˆã€foræ–‡ã®ä¸­ã®å‡¦ç†ã«å…¥ã‚‰ãšã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãšã«æ¸ˆã‚€
	for row.Next() {
		if err := row.Scan(&id, &name, &age); err != nil {
			return User{}, err
		}
	}

	// id, name, ageã¯row.Scanã•ã‚Œã¦ã„ãªã„ã®ã§å…¨ã¦åˆæœŸå€¤ã®ã¾ã¾
	user := User{
		Id:   id,
		Name: name,
		Age:  age,
	}

	// userãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã¯ä¾‹ãˆã°user.IdãŒç©ºæ–‡å­—ã§ãªã„ã‹ã©ã†ã‹ã§åˆ¤æ–­
	return user, nil
}
```

ã¡ãªã¿ã«`QueryRowContext`ã®ã¾ã¾ã§ã“ã‚“ãªå›é¿æ–¹æ³•ã‚‚ç„¡ãã¯ãªã„ã¨æ€ã„ã¾ã™ãŒã€ã‚ã¾ã‚Šã‚¹ãƒãƒ¼ãƒˆã§ã¯ãªã•ãã†ã§ã™ã€‚
```go
func FetchUser(ctx context.Context, userId string) (User, error) {
	// çœç•¥...
	if err := row.Scan(&id, &name, &age); err != nil {
		// ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒãªã„ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼æ‰±ã„ã—ãªã„ã‚ˆã†ã«åˆ¶å¾¡ã™ã‚‹
		if err.Error() == "sql: no rows in result set" {
			return User{}, nil
		}
		return User{}, err
	}
}
```

# CRUDå‡¦ç†ã®Readå‡¦ç†ã‚’ã—ãŸã„å ´åˆ(è¤‡æ•°ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¿”ã™)

```go
type User struct {
	Id   string
	Name string
	Age  int
}

func FetchUser() (ctx context.Context, []User, error) {
	query := `SELECT * FROM users`

	rows, err := Db.QueryContext(ctx, query, userId)

	if err != nil {
		return []User{}, err
	}

	defer rows.Close()

	// è¿”å´ã™ã‚‹useré…åˆ—ã®å™¨ã‚’ç”¨æ„ã™ã‚‹
	var users []User

	for rows.Next() {
		var (
			id, name string
		)

		var (
			age int
		)

		if err := rows.Scan(&id, &name, &age); err != nil {
			return []User{}, err
		}

		user := User{
			Id:   id,
			Name: name,
			Age:  age,
		}

		// é…åˆ—ã«è¿½åŠ 
		users = append(users, user)
	}

	return users, nil
}
```

# CRUDå‡¦ç†ã®Create,Update,Deleteå‡¦ç†ã‚’ã—ãŸã„å ´åˆ(SELECTæ–‡ã®ã‚ˆã†ã«ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ãªã„å‡¦ç†)

```go
func DeleteUser(ctx context.Context, userId string) error {
	command := `DELETE FROM users WHERE id = ?`

	// ä¸€ã¤ç›®ã®æˆ»ã‚Šå€¤ã‚’ä½¿ã†ãªã‚‰å—ã‘å–ã£ã¦ã‚‚è‰¯ã„ã€‚
	_, err := Db.ExecContext(ctx, command, userId)

	if err != nil {
		return err
	}

	return nil
}
```

# ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã¯ã‚ŠãŸã„

```go
func DeleteUser(ctx context.Context, userId string) error {
	tran, err := Db.Begin()
	if err != nil {
		return err
	}
	// ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸã‚‰ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹ã—ã€commitã•ã‚ŒãŸå ´åˆã¯ä½•ã‚‚èµ·ããªã„ã€‚
	defer tran.RollBack()

	command1 := `DELETE FROM users WHERE id = ?`

	_, err := Db.ExecContext(ctx, command1, userId)

	if err != nil {
		return err
	}

	command2 := `DELETE FROM permissions WHERE user_id = ?`

	_, err := Db.ExecContext(ctx, command2, userId)

	return tran.Commit()
}
```

# ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ã—ãŸã„å ´åˆ

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è©³ã—ã„è¿”ã—æ–¹ã¯[ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”å´ã—ãŸã„å ´åˆ](#ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”å´ã—ãŸã„å ´åˆ)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

```go
func main() {
	ExecRouter()

	// ã‚µãƒ¼ãƒã‚’ç«‹ã¦ã‚‹
	http.ListenAndServe(":8080", nil)

	// ã“ã“ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’é–‰ã˜ã‚‹ã€‚
	defer Db.Close()
}

func ExecRouter() {
	http.HandleFunc("/v1/user", UserHandler)
	http.HandleFunc("/v1/book", BookHandler)
}

func UserHandler(w http.ResponseWriter, r *http.Request) {
	prefix := "/v1/user/"

	switch r.URL.Path {
	case prefix + "create":
		if r.Method != "POST" {
			// æƒ³å®šã®HTTPãƒ¡ã‚½ãƒƒãƒ‰ã§ãªã‘ã‚Œã°405ã§ã‚¨ãƒ©ãƒ¼
			w.WriteHeader(StatusMethodNotAllowed)
			w.Write([]byte("è¨±å¯ã•ã‚Œã¦ã„ãªã„ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™"))
		}
		// usecaseã‚’å‘¼ã³å‡ºã™
	case prefix + "read":
		// ...
	case prefix + "update":
		// ...
	case prefix + "delete":
		// ...
	default:
		// å­˜åœ¨ã—ãªã„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãªã®ã§404ã§è¿”ã™
		w.WriteHeader(StatusNotFound)
		w.Write([]byte("å­˜åœ¨ã—ãªã„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã™"))
	}
}

func BookHandler(w http.ResponseWriter, r *http.Request) {
	// çœç•¥
}
```

ã¡ã‚ƒã‚“ã¨RESTfulã«ä½œã‚‹ãªã‚‰ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰ã§åˆ‡ã‚Šæ›¿ãˆã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚

```go
func UserHandler(w http.ResponseWriter, r *http.Request) {
	switch r.Method {
	case "GET":
		// ...
	case "POST":
		// ...
	case "PUT":
		// ...
	case "PATCH":
		// ...
	case "DELETE":
		// ...
	}
}
```

# ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«é©ç”¨ã™ã‚‹middlewareã‚’ä½œã‚ŠãŸã„å ´åˆ

```go
func AddHeader(next http.HandlerFunc) http.HandlerFunc {
	return func(w http.ResponseWriter, r *http.Request) {
		w.Header().Set("Access-Control-Allow-Headers", "ã©ã†ãŸã‚‰ã“ã†ãŸã‚‰")
		// ä»–ã«ã‚‚ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¶³ã—ãŸã‹ã£ãŸã‚‰ä»˜ã‘åŠ ãˆã‚‹
		next(w, r)
	}
}

func ExecRouter() {
	// ã“ã‚“ãªæ„Ÿã˜ã§ä½¿ãˆã‚‹ã€‚
	http.HandleFunc("/v1/user/", AddHeader(UserHandler))
}
```

# ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§å—ã‘å–ã£ãŸjsonã‚’æ§‹é€ ä½“ã«å¤‰æ›ã™ã‚‹æ±ç”¨çš„ãªmapperã‚’ä½œã‚ŠãŸã„å ´åˆ

```go
func ConstructInputData[T interface{}](r *http.Request, inputData T) error {
	// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚€ã€‚
	body, err := io.ReadAll(r.Body)
	if err != nil {
		return err
	}
	defer r.Body.Close()

	// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å¼•æ•°ã«å—ã‘å–ã£ãŸæ§‹é€ ä½“ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹
	err = json.Unmarshal(body, inputData)
	if err != nil {
		return err
	}

	return nil
}

// ã“ã‚“ãªæ„Ÿã˜ã§ä½¿ãˆã‚‹
func UserHandler(w http.ResponseWriter, r *http.Request) {
	prefix := "/v1/user/"

	switch r.URL.Path {
	case prefix + "create":
		// usecaseã«å¿œã˜ãŸinputDataã®æ§‹é€ ä½“ã‚’ç”¨æ„
		var inputData *createInputData
		// ãƒã‚¤ãƒ³ã‚¿å‹ã§æ¸¡ã™ã“ã¨
		err := ConstructInputData(r, inputData)
		// çœç•¥
	}
}
```

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”å´ã—ãŸã„å ´åˆ

```go
func UserHandler(w http.ResponseWriter, r *http.Request) {
	prefix := "/v1/user/"

	switch r.URL.Path {
	case prefix + "create":
		var inputData *createInputData
		err := ConstructInputData(r, inputData)

		if err != nil {
			w.WriteHeader(http.StatusBadRequest)
			w.Write(err)
			return
		}

		// è‰²ã€…ã¨å‡¦ç†ã‚’ã™ã‚‹

		// usecaseã«inputDataã‚’æ¸¡ã—ã¦ã€çµæœã‚’æ§‹é€ ä½“ã§å—ã‘å–ã‚‹
		// *http.Requestã¯Contextã‚’æŒã£ã¦ã„ã‚‹ã®ã§ã€
		// ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤â†’ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã¨å¼•ãå›ã™
		result, err := usecase.create(r.Context(), inputData)

		if err != nil {
			w.WriteHeader(http.StatusInternalServerError)
			w.Write(err)
			return
		}

		res, err := json.Marshal(result)

		if err != nil {
			w.WriteHeader(http.StatusInternalServerError)
			w.Write(err)
			return
		}

		// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”å´ã™ã‚‹
		w.WriteHeader(http.StatusOK)
		w.Write(res)
	}
}

// usecase.Createã®æˆ»ã‚Šå€¤ã¯ã“ã‚“ãªæ§‹é€ ä½“ã¨ã™ã‚‹ã€‚
type Result struct {
	IsSuccess bool `json:"isSuccess"` // ã“ã†æ›¸ãã¨jsonä¸Šã§ã¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åãŒisSuccessã«ãªã‚‹
}
```

ã¡ãªã¿ã«mapã‚’ä½¿ã£ã¦ã“ã‚“ãªå½¢ã§ã‚‚æ›¸ã‘ã‚‹ã€‚

```go
func UserHanlder() {
	// çœç•¥
	res, err := json.Marshal(map[string]interface{}{
		"isSuccess": result.IsSuccess,
	})
	w.Write(res)
	// çœç•¥
}
```

# httpã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã—ã¦Goã‚’ä½¿ã„ãŸã„å ´åˆ

```go
// é•·ããªã‚‹ã®ã§ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯çœç•¥ã—ã¦ã‚ã‚Šã¾ã™
// ç©ºã®ã‚¹ãƒ©ã‚¤ã‚¹ã¨ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã™ã‚Œã°ã‚ˆã„ã‹ã¨æ€ã„ã¾ã™
func FetchLogs(host string) ([]Log, error) {
	// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã€‚è‰²ã€…è¨­å®šã§ãã¾ã™ãŒã€ã‚ˆãä½¿ã„ãã†ãªtimeoutã ã‘ç´¹ä»‹ã€‚
	c := http.Client{
		Timeout: 10 * time.Second,
	}

	// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã€‚ç¬¬äºŒå¼•æ•°ã¯ã‚³ãƒ¼ãƒ«ã—ãŸã„APIã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã€‚
	// ç¬¬ä¸‰å¼•æ•°ã¯POSTãƒ¡ã‚½ãƒƒãƒ‰ã®Body
	req, err := http.NewRequest("GET", host, nil)

	// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®Ÿè¡Œ
	res, err := c.Do(req)

	// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’èª­ã¿è¾¼ã‚€
	body, err := io.ReadAll(res.Body)

	// APIæ§‹ç¯‰ã®æ™‚åŒæ§˜å¿…ãšé–‰ã˜ã‚‹
	defer res.Body.Close()

	var result []Log // è¿”å´ã—ãŸã„æ§‹é€ ä½“ã®ãƒã‚¤ãƒ³ã‚¿å‹

	err = json.Unmarshal(body, result)

	return result, nil
}
```

# ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ãŸã„å ´åˆ

```go
import "github.com/caarlos0/env/v6"

type Config struct {
	// ç’°å¢ƒå¤‰æ•°ãŒã‚ã‚Œã°èª­ã¿è¾¼ã‚€ã—ã€ãªã‘ã‚Œã°envDefaultã®å€¤ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹
	ApiKey string `env:"API_KEY" envDefault:"dummy_api_key`
}

func NewConfig()(Config, error) {
	conf := Config{}

	// env/v6ã£ã¦ã„ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã§ã™ãŒã€v6.Parseã¨ã¯æ›¸ã‘ãªã„ã®ã§æ³¨æ„ã€‚
	err := env.Parse(conf)
	if err != nil {
		return nil,err
	}
	return conf, nil
}
```

æ¨™æº–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã†ã¨ã“ã‚“ãªæ„Ÿã˜ã€‚
ã“ã¡ã‚‰ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨åŒã˜ãã€inité–¢æ•°ã‚’èµ°ã‚‰ã›ã¦Confå¤‰æ•°ã‚’ä½¿ã„å›ã™å½¢ã«ã—ã¦ã¿ã¾ã—ãŸã€‚

```go
import "github.com/caarlos0/env/v6"

type Config struct {
	ApiKey string
}

var Conf *Config

func init() {
	conf := &Config{
		// ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãªã‘ã‚Œã°ç©ºæ–‡å­—ã®ã¾ã¾
		ApiKey: os.Getenv("API_KEY")
	}
	Conf = conf
}
```

# ãŠã‚ã‚Šã«

å®Ÿå‹™ã§ã¯Ginã‚„Gormç­‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ã‚±ãƒ¼ã‚¹ãŒå¤šã„ã¨æ€ã„ã¾ã™ãŒã€ä»Šå›ã¯ã‚¹ã‚¯ãƒ©ãƒƒãƒæ°—å‘³ãªå®Ÿè£…ã‚’ç´¹ä»‹ã—ã¦ã¿ã¾ã—ãŸã€‚
ã‚¹ã‚¯ãƒ©ãƒƒãƒã§ã‚‚å…¨ç„¶ã‚¤ã‚±ã‚‹æ„Ÿã˜ã™ã‚‹ã®ãŒGoã®å¥½ããªã¨ã“ã‚ã§ã™ã­ã€‚
ã‚‚ã£ã¨è‰¯ã„å®Ÿè£…ã‚ã‚‹ã‚ˆã€ã¨ã„ã†å ´åˆã¯æ˜¯éã‚³ãƒ¡ãƒ³ãƒˆã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚
